{
    "__inputs": [
      {
        "name": "DS_BIGQUERY",
        "label": "biguery",
        "description": "",
        "type": "datasource",
        "pluginId": "grafana-bigquery-datasource",
        "pluginName": "Google BigQuery"
      }
    ],
    "__elements": {},
    "__requires": [
      {
        "type": "panel",
        "id": "barchart",
        "name": "Bar chart",
        "version": ""
      },
      {
        "type": "grafana",
        "id": "grafana",
        "name": "Grafana",
        "version": "10.4.0-65610"
      },
      {
        "type": "datasource",
        "id": "grafana-bigquery-datasource",
        "name": "Google BigQuery",
        "version": "1.2.6"
      },
      {
        "type": "panel",
        "id": "stat",
        "name": "Stat",
        "version": ""
      },
      {
        "type": "panel",
        "id": "table",
        "name": "Table",
        "version": ""
      },
      {
        "type": "panel",
        "id": "timeseries",
        "name": "Time series",
        "version": ""
      }
    ],
    "annotations": {
      "list": [
        {
          "builtIn": 1,
          "datasource": {
            "type": "grafana",
            "uid": "-- Grafana --"
          },
          "enable": true,
          "hide": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "name": "Annotations & Alerts",
          "target": {
            "limit": 100,
            "matchAny": false,
            "tags": [],
            "type": "dashboard"
          },
          "type": "dashboard"
        }
      ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": null,
    "links": [],
    "liveNow": false,
    "panels": [
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 0
        },
        "id": 23,
        "panels": [],
        "title": "Costs",
        "type": "row"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 4,
          "x": 0,
          "y": 1
        },
        "id": 15,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "Select sum(total_estimated_cost_usd) as total_cost\nfrom `leaner_query.rpt_bigquery_usage_cost_daily`\nwhere report_date = current_date() - 1",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Estimated Total Cost (Yesterday)",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "decimals": 0,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "none",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 7,
          "w": 4,
          "x": 4,
          "y": 1
        },
        "id": 16,
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "calcs": [
              "lastNotNull"
            ],
            "fields": "",
            "values": false
          },
          "showPercentChange": false,
          "textMode": "auto",
          "wideLayout": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "Select sum(total_queries_run) as total_query_count\nfrom `leaner_query.rpt_bigquery_usage_cost_daily`\nwhere report_date = current_date() - 1",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Total Queries Run Yesterday",
        "type": "stat"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Cost changes (7 day and 30 day) for clients that have accumulated at least $1 in query costs over the past day.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                }
              ]
            },
            "unit": "none",
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "total_estimated_cost_usd"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "currencyUSD"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "thirty_day_avg"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "currencyUSD"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "seven_day_avg"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "currencyUSD"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "seven_day_change"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percentunit"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "thirty_day_change"
              },
              "properties": [
                {
                  "id": "unit",
                  "value": "percentunit"
                },
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "mode": "lcd",
                    "type": "gauge",
                    "valueDisplayMode": "color"
                  }
                },
                {
                  "id": "thresholds",
                  "value": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green",
                        "value": null
                      },
                      {
                        "color": "red",
                        "value": 1e-9
                      }
                    ]
                  }
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "seven_day_change"
              },
              "properties": [
                {
                  "id": "custom.cellOptions",
                  "value": {
                    "mode": "lcd",
                    "type": "gauge",
                    "valueDisplayMode": "color"
                  }
                },
                {
                  "id": "thresholds",
                  "value": {
                    "mode": "absolute",
                    "steps": [
                      {
                        "color": "green",
                        "value": null
                      },
                      {
                        "color": "red",
                        "value": 1e-8
                      }
                    ]
                  }
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 7,
          "w": 16,
          "x": 8,
          "y": 1
        },
        "id": 17,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true,
          "sortBy": [
            {
              "desc": true,
              "displayName": "Total Est Cost"
            }
          ]
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "with aggs as(\n  select\n    report_date,\n    client_type,\n    total_estimated_cost_usd,\n    avg(total_estimated_cost_usd) over (partition by client_type order by report_date rows between 6 preceding and current row) as seven_day_avg,\n    avg(total_estimated_cost_usd) over (partition by client_type order by report_date rows between 29 preceding and current row) as thirty_day_avg\n  from `leaner_query.rpt_bigquery_usage_cost_daily`\n  where report_date >= current_date - 31\n)\nselect\n  client_type,\n  aggs.total_estimated_cost_usd,\n  thirty_day_avg,\n  seven_day_avg,\n  safe_divide((total_estimated_cost_usd - seven_day_avg), seven_day_avg) as seven_day_change,\n  safe_divide((total_estimated_cost_usd - thirty_day_avg), thirty_day_avg) as thirty_day_change\nfrom aggs\nwhere report_date = current_date - 1\nand aggs.total_estimated_cost_usd > 1.0\norder by 2 desc",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Cost Trends by Client Type",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {
                "client_type": 0,
                "seven_day_avg": 2,
                "seven_day_change": 4,
                "thirty_day_avg": 3,
                "thirty_day_change": 5,
                "total_estimated_cost_usd": 1
              },
              "renameByName": {
                "client_type": "Client Type",
                "seven_day_avg": "Seven Day Avg Cost",
                "seven_day_change": "Seven Day Cost Change",
                "thirty_day_avg": "Thirty Day Avg Cost",
                "thirty_day_change": "Thirty Day Cost Change",
                "total_estimated_cost_usd": "Total Est Cost"
              }
            }
          }
        ],
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 2,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green",
                  "value": null
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 12,
          "w": 24,
          "x": 0,
          "y": 8
        },
        "id": 3,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "with total_costs as(\n  select\n  timestamp(report_date) as report_date\n  , sum(total_estimated_cost_usd) as sum_cost\nfrom `leaner_query.rpt_bigquery_user_metrics_daily`\nwhere username in ($usernames)\n  and user_type in ($user_type)\n  and $__timeFilter(timestamp(report_date)) \n  -- and report_date != current_date\ngroup by 1\n)\nSelect *,\nCase \n  when Lag(report_date, 7) over(order by report_date) is null then null\n  else avg(sum_cost) over(order by report_date rows between 6 preceding and current row)\nEnd as rolling_avg  \nfrom total_costs\nORDER BY 2\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Aggregated Costs",
        "transformations": [
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "includeByName": {},
              "indexByName": {},
              "renameByName": {
                "report_date": "Report Date",
                "rolling_avg": "Rolling Avg",
                "sum_cost": "Cost"
              }
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 2,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 13,
          "w": 24,
          "x": 0,
          "y": 20
        },
        "id": 18,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": false
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select\n  timestamp(report_date) as report_date\n  , user_type\n  , username\n  , sum(total_estimated_cost_usd) as sum_cost\nfrom `leaner_query.rpt_bigquery_user_metrics_daily`\nwhere username in ($usernames)\n  and user_type in ($user_type)\n  and $__timeFilter(timestamp(report_date)) \n  -- and report_date != current_date\ngroup by 1,2,3\norder by 3",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Individual Users and Costs",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "username",
              "rowField": "report_date",
              "valueField": "sum_cost"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 2,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 13,
          "w": 24,
          "x": 0,
          "y": 33
        },
        "id": 19,
        "options": {
          "legend": {
            "calcs": [
              "first",
              "last",
              "diff",
              "diffperc"
            ],
            "displayMode": "table",
            "placement": "right",
            "showLegend": true,
            "sortBy": "Last",
            "sortDesc": true,
            "width": 300
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select\n  timestamp(report_date) as report_date\n  , client_type\n  , total_estimated_cost_usd as sum_cost\nfrom `leaner_query.rpt_bigquery_usage_cost_daily`\nwhere $__timeFilter(timestamp(report_date)) \n-- group by 1,2\norder by 1",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Costs by Client Type",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "client_type",
              "rowField": "report_date",
              "valueField": "sum_cost"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\client_type"
                }
              ],
              "fields": {}
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Daily costs associated with dbt runs, tests, and snapshots.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineWidth": 1,
              "pointSize": 2,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "auto",
              "spanNulls": false,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 10,
          "w": 24,
          "x": 0,
          "y": 46
        },
        "id": 14,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select\n  timestamp(report_date) as report_date,\n  round(sum(total_estimated_dbt_run_cost_usd), 2) as daily_build_cost,\n  round(sum(total_estimated_dbt_test_cost_usd), 2) as daily_test_cost,\n  round(sum(total_estimated_dbt_snapshot_cost_usd), 2) as daily_snapshot_cost\nfrom `leaner_query.rpt_bigquery_dbt_metrics_daily`\nwhere $__timeFilter(timestamp(report_date)) \ngroup by 1\n\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Dbt Costs",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "daily_build_cost": "Daily Build Cost",
                "daily_snapshot_cost": "Daily Snapshot Cost",
                "daily_test_cost": "Daily Test Cost"
              }
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false,
              "minWidth": 80
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "table_name"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Table Name"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "priority_score"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Priority Score"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "total_dbt_builds"
              },
              "properties": [
                {
                  "id": "unit"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 56
        },
        "id": 10,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  dbt_model_name,\n  total_estimated_dbt_run_cost_usd,\n  average_build_cost,\n  total_dbt_builds\nfrom `leaner_query.rpt_bigquery_dbt_metrics_daily`\nwhere report_date = current_date - 1\norder by 2 desc\nlimit 25",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Top 25 Expensive DBT Runs",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "average_build_cost": "Avg Build Cost",
                "dbt_model_name": "Model",
                "importance_score": "Importance Score",
                "total_dbt_builds": "Total Builds",
                "total_estimated_dbt_run_build_cost_usd": "Estimated Cost",
                "total_estimated_dbt_run_cost_usd": "Total Build Cost"
              }
            }
          }
        ],
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "table_name"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Table Name"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "priority_score"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Priority Score"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "total_dbt_tests"
              },
              "properties": [
                {
                  "id": "unit"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 56
        },
        "id": 11,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  dbt_model_name,\n  total_estimated_dbt_test_cost_usd,\n  average_test_cost,\n  total_dbt_tests\nfrom `leaner_query.rpt_bigquery_dbt_metrics_daily`\nwhere report_date = current_date - 1\norder by 2 desc\nlimit 25",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Top 25 Expensive DBT Tests",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "average_test_cost": "Avg Test Cost",
                "dbt_model_name": "Test",
                "importance_score": "Importance Score",
                "total_dbt_tests": "Total Tests",
                "total_estimated_dbt_test_build_cost_usd": "Estimated Cost",
                "total_estimated_dbt_test_cost_usd": "Total Test Cost"
              }
            }
          }
        ],
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "currencyUSD",
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "table_name"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Table Name"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "priority_score"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Priority Score"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "total_dbt_snapshots"
              },
              "properties": [
                {
                  "id": "unit"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "Snapshot"
              },
              "properties": [
                {
                  "id": "custom.width",
                  "value": 449
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 64
        },
        "id": 12,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true,
          "sortBy": []
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  dbt_model_name,\n  total_estimated_dbt_snapshot_cost_usd,\n  average_snapshot_cost,\n  total_dbt_snapshots\nfrom `leaner_query.rpt_bigquery_dbt_metrics_daily`\nwhere report_date = current_date - 1\norder by 2 desc\nlimit 25",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Top 25 Expensive DBT Snapshots",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "average_snapshot_cost": "Avg Snapshot Cost",
                "dbt_model_name": "Snapshot",
                "importance_score": "Importance Score",
                "total_dbt_snapshots": "Total Snapshots",
                "total_estimated_dbt_snapshot_build_cost_usd": "Estimated Cost",
                "total_estimated_dbt_snapshot_cost_usd": "Total Snapshot Cost"
              }
            }
          }
        ],
        "type": "table"
      },
      {
        "collapsed": false,
        "gridPos": {
          "h": 1,
          "w": 24,
          "x": 0,
          "y": 72
        },
        "id": 24,
        "panels": [],
        "title": "Usage Stats",
        "type": "row"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Tracks the number of BigQuery errors for each user on a given day.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 0,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 13,
          "w": 24,
          "x": 0,
          "y": 73
        },
        "id": 9,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": false
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select\n  timestamp(report_date) as report_date\n  , user_type\n  , username\n  , total_errors\nfrom `leaner_query.rpt_bigquery_user_metrics_daily`\nwhere username in ($usernames)\n  and user_type in ($user_type)\n  and $__timeFilter(timestamp(report_date)) \n  -- and report_date != current_date\n-- group by 1,2,3\norder by 3",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Individual Users and Errors",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "username",
              "rowField": "report_date",
              "valueField": "total_errors"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Tracks the percent total of BigQuery errors for each user on a given day.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "axisSoftMax": 1,
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "decimals": 0,
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percentunit",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 13,
          "w": 24,
          "x": 0,
          "y": 86
        },
        "id": 22,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "bottom",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "with base as (\n  select\n    timestamp(report_date) as report_date\n    , user_type\n    , username\n    , total_errors\n  from `leaner_query.rpt_bigquery_user_metrics_daily`\n  where username in ($usernames)\n  and user_type in ($user_type)\n  and $__timeFilter(timestamp(report_date)) \n),\n\ntotal_errors as (\n  select\n    report_date,\n    sum(total_errors) as num_total_errors\n  from base\n  group by 1\n)\n\nselect\n  base.report_date,\n  base.user_type,\n  base.username,\n  round(base.total_errors / total_errors.num_total_errors, 2) as perc_total_errors\nfrom base\nleft join total_errors\n  on base.report_date = total_errors.report_date\norder by 4 desc\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Percent Total of Individual Users and Errors",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "username",
              "rowField": "report_date",
              "valueField": "perc_total_errors"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Shows how many users have queried each of the layers for a given day. Users can query more than one layer.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "axisSoftMax": 1,
              "axisSoftMin": 0,
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 10,
          "w": 24,
          "x": 0,
          "y": 99
        },
        "id": 8,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "right",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "\n  select\n    timestamp(report_date) as report_date\n    -- , count(distinct if(total_tables_used > 0, username, null)) as users\n    , count(if(total_prod_tables_used > 0, 1, null)) as used_prod\n    , count(if(total_stage_tables_used > 0, 1, null)) as used_stage\n    , count(if(total_raw_tables_used > 0, 1, null)) as used_raw\n  from `leaner_query.rpt_bigquery_user_metrics_daily`\n  where username in ($usernames)\n    and user_type in ($user_type)\n    and $__timeFilter(timestamp(report_date)) \n  group by 1\n\n",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Distinct Users by Layer",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "username",
              "rowField": "report_date",
              "valueField": "sum_cost"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "includeByName": {},
              "indexByName": {},
              "renameByName": {
                "report_date": "Report Date",
                "used_prod": "Prod",
                "used_raw": "Raw",
                "used_stage": "Stage"
              }
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Shows what percentage (of the total use) each data layer was used in queries.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "axisSoftMax": 1,
              "axisSoftMin": 0,
              "barAlignment": 0,
              "drawStyle": "line",
              "fillOpacity": 0,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "insertNulls": false,
              "lineInterpolation": "linear",
              "lineStyle": {
                "fill": "solid"
              },
              "lineWidth": 1,
              "pointSize": 5,
              "scaleDistribution": {
                "type": "linear"
              },
              "showPoints": "never",
              "spanNulls": true,
              "stacking": {
                "group": "A",
                "mode": "none"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "percentunit",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 10,
          "w": 24,
          "x": 0,
          "y": 109
        },
        "id": 20,
        "options": {
          "legend": {
            "calcs": [],
            "displayMode": "table",
            "placement": "right",
            "showLegend": true
          },
          "tooltip": {
            "mode": "single",
            "sort": "none"
          }
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "with daily_totals as(\nSELECT \n report_date,\n sum(total_prod_tables_used) as total_prod_tables_used,\n sum(total_stage_tables_used) as total_stage_tables_used,\n sum(total_raw_tables_used) as total_raw_tables_used,\n FROM `leaner_query.rpt_bigquery_user_metrics_daily` \n  where username in ($usernames)\n    and user_type in ($user_type)\n    and $__timeFilter(timestamp(report_date)) \n group by 1\n ),\nadd_total_use as(\n  select *,\n    daily_totals.total_prod_tables_used + daily_totals.total_stage_tables_used + daily_totals.total_raw_tables_used as total_tables_used\n  from daily_totals\n)\nselect \n  timestamp(report_date) as report_date,\n  add_total_use.total_prod_tables_used / add_total_use.total_tables_used as `Percent Prod Used`,\n  add_total_use.total_stage_tables_used / add_total_use.total_tables_used as `Percent Stage Used`,\n  add_total_use.total_raw_tables_used / add_total_use.total_tables_used as `Percent Raw Used`,\nfrom add_total_use;",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Percent layer use",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "username",
              "rowField": "report_date",
              "valueField": "sum_cost"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          },
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "includeByName": {},
              "indexByName": {},
              "renameByName": {
                "Percent Prod Used": "Percent Prod",
                "Percent Raw Used": "Percent Raw",
                "Percent Stage Used": "Percent Stage"
              }
            }
          }
        ],
        "type": "timeseries"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "Shows the total number of times each data layer was used in queries.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "palette-classic"
            },
            "custom": {
              "axisBorderShow": false,
              "axisCenteredZero": false,
              "axisColorMode": "text",
              "axisLabel": "",
              "axisPlacement": "auto",
              "fillOpacity": 80,
              "gradientMode": "none",
              "hideFrom": {
                "legend": false,
                "tooltip": false,
                "viz": false
              },
              "lineWidth": 1,
              "scaleDistribution": {
                "type": "linear"
              },
              "thresholdsStyle": {
                "mode": "off"
              }
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unit": "none",
            "unitScale": true
          },
          "overrides": []
        },
        "gridPos": {
          "h": 10,
          "w": 24,
          "x": 0,
          "y": 119
        },
        "id": 21,
        "options": {
          "barRadius": 0,
          "barWidth": 0.97,
          "fullHighlight": false,
          "groupWidth": 0.7,
          "legend": {
            "calcs": [],
            "displayMode": "list",
            "placement": "bottom",
            "showLegend": true
          },
          "orientation": "auto",
          "showValue": "auto",
          "stacking": "normal",
          "tooltip": {
            "mode": "single",
            "sort": "none"
          },
          "xTickLabelRotation": 45,
          "xTickLabelSpacing": 100
        },
        "pluginVersion": "9.4.4-2911eec",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "SELECT \n timestamp(report_date),\n sum(total_prod_tables_used) as `Total prod tables used`,\n sum(total_stage_tables_used) as `Total stage tables used`,\n sum(total_raw_tables_used) as `Total rawtables used`,\n FROM `leaner_query.rpt_bigquery_user_metrics_daily` \n  where username in ($usernames)\n    and user_type in ($user_type)\n    and $__timeFilter(timestamp(report_date)) \n group by 1",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Table usage by layer",
        "transformations": [
          {
            "id": "groupingToMatrix",
            "options": {
              "columnField": "username",
              "rowField": "report_date",
              "valueField": "sum_cost"
            }
          },
          {
            "id": "convertFieldType",
            "options": {
              "conversions": [
                {
                  "destinationType": "time",
                  "targetField": "report_date\\username"
                }
              ],
              "fields": {}
            }
          }
        ],
        "type": "barchart"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "This table contains the top 25 tables in your BQ instance which have the highest threat levels.\n\nA table risk score is determined by how many external systems are connected via service accounts, the median cost to query, median cost to build, and the median daily errors incurred.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "table_name"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Table Name"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "priority_score"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Priority Score"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 129
        },
        "id": 6,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  concat(split(table_name, '/')[safe_offset(3)], '.', split(table_name, '/')[safe_offset(5)]) as table_name\n, threat_score\nfrom `leaner_query.rpt_bigquery_table_usage_daily`\nwhere report_date = current_date -1\n  and threat_score is not null\norder by threat_score desc\nlimit 25 -- maybe a rank instead of this later on",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Top 25 Riskiest Tables",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "table_name": "Table Name",
                "threat_score": "Threat Score"
              }
            }
          }
        ],
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "This table contains the top 25 tables in your BQ instance which have the highest importance levels.\n\nThe importance calculation is a combination of Service Account usage, breadth of non-service account use, external system use, and the degree to which other data objects depend on this object.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "table_name"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Table Name"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "priority_score"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Priority Score"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 12,
          "y": 129
        },
        "id": 7,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  concat(split(table_name, '/')[safe_offset(3)], '.', split(table_name, '/')[safe_offset(5)]) as table_name\n, importance_score\nfrom `leaner_query.rpt_bigquery_table_usage_daily`\nwhere report_date = current_date -1\n  and importance_score is not null\norder by importance_score desc\nlimit 25 -- maybe a rank instead of this later on",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Top 25 Important Tables",
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {},
              "indexByName": {},
              "renameByName": {
                "importance_score": "Importance Score"
              }
            }
          }
        ],
        "type": "table"
      },
      {
        "datasource": {
          "type": "grafana-bigquery-datasource",
          "uid": "${DS_BIGQUERY}"
        },
        "description": "This table contains the top 25 tables in your BQ instance which should have priority to be examined for optimization.",
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "custom": {
              "align": "auto",
              "cellOptions": {
                "type": "auto"
              },
              "inspect": false
            },
            "mappings": [],
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {
                  "color": "green"
                },
                {
                  "color": "red",
                  "value": 80
                }
              ]
            },
            "unitScale": true
          },
          "overrides": [
            {
              "matcher": {
                "id": "byName",
                "options": "table_name"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Table Name"
                }
              ]
            },
            {
              "matcher": {
                "id": "byName",
                "options": "priority_score"
              },
              "properties": [
                {
                  "id": "displayName",
                  "value": "Priority Score"
                }
              ]
            }
          ]
        },
        "gridPos": {
          "h": 8,
          "w": 12,
          "x": 0,
          "y": 137
        },
        "id": 5,
        "options": {
          "cellHeight": "sm",
          "footer": {
            "countRows": false,
            "fields": "",
            "reducer": [
              "sum"
            ],
            "show": false
          },
          "showHeader": true
        },
        "pluginVersion": "10.4.0-65610",
        "targets": [
          {
            "datasource": {
              "type": "grafana-bigquery-datasource",
              "uid": "${DS_BIGQUERY}"
            },
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  concat(split(table_name, '/')[safe_offset(3)], '.', split(table_name, '/')[safe_offset(5)]) as table_name\n, priority_score\nfrom `leaner_query.rpt_bigquery_table_usage_daily`\nwhere report_date = current_date -1\n  and priority_score is not null\norder by priority_score desc\nlimit 25 -- maybe a rank instead of this later on",
            "refId": "A",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          }
        ],
        "title": "Top 25 Priority Tables",
        "type": "table"
      }
    ],
    "refresh": "",
    "revision": 1,
    "schemaVersion": 39,
    "tags": [],
    "templating": {
      "list": [
        {
          "current": {},
          "datasource": {
            "type": "grafana-bigquery-datasource",
            "uid": "${DS_BIGQUERY}"
          },
          "definition": "",
          "hide": 0,
          "includeAll": true,
          "label": "Usernames",
          "multi": true,
          "name": "usernames",
          "options": [],
          "query": {
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  username\nfrom `leaner_query.rpt_bigquery_user_metrics_daily`\nwhere report_date > '1000-03-01'\norder by username asc",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 1,
          "type": "query"
        },
        {
          "current": {},
          "datasource": {
            "type": "grafana-bigquery-datasource",
            "uid": "${DS_BIGQUERY}"
          },
          "definition": "",
          "hide": 0,
          "includeAll": true,
          "label": "User Type",
          "multi": true,
          "name": "user_type",
          "options": [],
          "query": {
            "editorMode": "code",
            "format": 1,
            "location": "US",
            "project": "",
            "rawQuery": true,
            "rawSql": "select distinct\n  user_type\nfrom `leaner_query.rpt_bigquery_user_metrics_daily`\nwhere report_date > '1000-03-01'\norder by 1",
            "sql": {
              "columns": [
                {
                  "parameters": [],
                  "type": "function"
                }
              ],
              "groupBy": [
                {
                  "property": {
                    "type": "string"
                  },
                  "type": "groupBy"
                }
              ],
              "limit": 50
            }
          },
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "sort": 1,
          "type": "query"
        },
        {
          "current": {
            "selected": true,
            "text": "biguery",
            "value": "BWkWsc1nk"
          },
          "hide": 0,
          "includeAll": false,
          "label": "BigQuery Datasource",
          "multi": false,
          "name": "bigquery_datasource",
          "options": [],
          "query": "grafana-bigquery-datasource",
          "queryValue": "",
          "refresh": 1,
          "regex": "",
          "skipUrlSync": false,
          "type": "datasource"
        }
      ]
    },
    "time": {
      "from": "now-1y",
      "to": "now - 1d"
    },
    "timepicker": {},
    "timezone": "",
    "title": "BigQuery & DBT metrics",
    "uid": "",
    "version": 92,
    "weekStart": ""
  }